rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 允許公開讀取運動類型集合（所有用戶可讀）
    match /exerciseTypes/{document=**} {
      allow read: if true;
      allow write: if request.auth != null;  // 僅認證用戶可寫
    }
    
    // 允許公開讀取身體部位集合（所有用戶可讀）
    match /bodyParts/{document=**} {
      allow read: if true;
      allow write: if request.auth != null;  // 僅認證用戶可寫
    }
    
    // 運動數據集合（公開讀取）- 注意集合名稱為 exercise（單數）
    match /exercise/{document=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 如果也有 exercises（複數）集合，也允許讀取
    match /exercises/{document=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // 用戶相關數據（需要認證）
    match /users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 訓練計劃（需要認證）
    match /workoutPlans/{planId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        (resource.data.creatorId == request.auth.uid || 
         resource.data.traineeId == request.auth.uid);
    }
    
    // 預約數據（需要認證）
    match /bookings/{bookingId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        (resource.data.userId == request.auth.uid || 
         resource.data.trainerId == request.auth.uid);
    }
    
    // 其他集合的默認規則
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}

